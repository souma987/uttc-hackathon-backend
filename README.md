# ハッカソンバックエンド
Go 言語で実装された、UTTC 8期 ハッカソンのためのプロジェクトのバックエンドです。

## 機能
セキュリティと、適切なパッケージ分割に力を入れました。例えば商品を購入するときは、フロントエンドから Firebase のトークンを送ってもらい、検証することで他人のアカウントでの購入を防いでいます。また、下記のようなパッケージ構造にすることで、CORSや認証が簡単に適用でき、単体テストも容易になっています。

### セキュリティ
- 認証ミドルウェア (`/internal/middleware/auth.go`) を作成し、`/internal/app/app.go` 内で各ルートに適用することで、認証が必要なルートが明確に定義できるようにしました。
- 各サービス内で適切なバリデーションを行うよう務めました。それぞれのサービスには対応する単体テストがあります。
- 可能な範囲で MySQL の CONSTRAINT を使い、不整合なデータが入りこまないようにしました。使った SQL は `/migrations` 内にあります
- 認証情報はコードに含めず、すべて環境変数で渡すようにしました。使った環境変数を管理しやすいよう、すべて `main.go` で読み取っています。
- データベースのスキーマ変更の SQL を `/migrations` に保存することで、スキーマの検証や復旧が行いやすいようにしました。

### パッケージ分割・ディレクトリ構造
- **main.go** - プログラムのエントリーポイント。環境変数の読み取り、各種サービスのクライアント初期化・破棄を担う。
- **internal** - サーバーの実装。
  - **app** - バックエンドの HTTP サーバーの全機能を持ったハンドラーを提供する。各ハンドラーをルーティングし、認証ミドルウェアを適用する。
  - **middleware** - 複数のエンドポイントに適用すべき処理を実装。具体的には CORS ヘッダの処理と Firebase トークンの認証。
  - **handler** - 各エンドポイントの HTTP 処理を行う。各エンドポイントごとにファイル分けされ、リクエストとレスポンスのフォーマットがドキュメントされている。
  - **service** - ビジネスロジックを含み、HTTP や DB に固有の処理は含まない。インタフェースを受け入れるため、モックリポジトリを使ったテストを含む。
  - **repository** - 他のプログラム (CloudSQL や VertexAI) とやり取りを行う。基本的にはデータの受け渡しのみで、データの変更等は行わない。
  - **client** - 他のプログラムとやり取りするための設定を行う。MySQL, Firebase, VertexAI がある。
- **migrations** - MySQL のスキーマ変更時に使った SQL を順に記録している。
